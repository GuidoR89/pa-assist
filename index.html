<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PA-Assist | Portale Incentivi Comuni</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs" defer></script>
    <style>
        [x-cloak] { display: none !important; }
        .bg-gradient-custom { background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%); }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 font-sans antialiased">

    <div x-data="paAssist()" x-init="initApp()" class="min-h-screen">
        
        <header class="bg-gradient-custom text-white py-12 px-4 shadow-lg">
            <div class="max-w-4xl mx-auto text-center">
                <h1 class="text-5xl font-extrabold tracking-tight">PA-Assist <span class="text-blue-200">3.0</span></h1>
                <p class="mt-4 text-xl text-blue-100 opacity-90">Il consulente digitale per sbloccare i fondi del tuo Comune</p>
                <div class="mt-6 inline-flex items-center bg-blue-800/30 px-4 py-2 rounded-full text-sm border border-blue-400/30">
                    <span class="relative flex h-3 w-3 mr-3">
                        <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                        <span class="relative inline-flex rounded-full h-3 w-3 bg-green-500"></span>
                    </span>
                    Database aggiornato: Febbraio 2026
                </div>
            </div>
        </header>

        <main class="max-w-5xl mx-auto px-4 -mt-10">
            
            <div class="bg-white p-8 rounded-3xl shadow-2xl border border-slate-200 mb-10 transition-all hover:border-blue-300">
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold text-slate-800">Seleziona il tuo Ente</h2>
                    <p class="text-slate-500">Inserisci il nome del comune per analizzare i bandi attivi</p>
                </div>
                
                <div class="relative max-w-2xl mx-auto">
                    <div class="flex items-center border-2 border-slate-100 rounded-2xl focus-within:border-blue-500 transition-all bg-slate-50 overflow-hidden px-4">
                        <svg class="w-6 h-6 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                        <input 
                            type="text" 
                            x-model="search" 
                            @input.debounce.300ms="filterComuni()"
                            placeholder="Scrivi il nome del comune (es: Bagnolo Mella)..." 
                            class="w-full p-5 bg-transparent outline-none text-xl font-medium"
                        >
                    </div>

                    <div x-show="suggestions.length > 0" x-cloak class="absolute z-50 w-full bg-white border border-slate-200 shadow-2xl rounded-2xl mt-2 max-h-64 overflow-y-auto overflow-hidden">
                        <template x-for="c in suggestions" :key="c.nome">
                            <div @click="selectComune(c)" class="p-4 hover:bg-blue-50 cursor-pointer border-b border-slate-100 last:border-0 flex justify-between items-center transition-colors">
                                <div>
                                    <span class="font-bold text-slate-800" x-text="c.nome"></span>
                                    <span class="text-slate-400 text-sm ml-2" x-text="'(' + c.sigla + ')'"></span>
                                </div>
                                <span class="text-xs bg-slate-100 text-slate-500 px-2 py-1 rounded uppercase tracking-widest font-bold" x-text="c.regione.nome"></span>
                            </div>
                        </template>
                    </div>
                </div>
            </div>

            <div x-show="selectedComune" x-cloak class="animate-in fade-in slide-in-from-bottom-4 duration-700">
                
                <div class="flex flex-wrap items-center justify-between mb-8 gap-4 bg-white p-6 rounded-2xl border border-slate-200 shadow-sm">
                    <div>
                        <h2 class="text-3xl font-black text-slate-900" x-text="selectedComune.nome"></h2>
                        <p class="text-slate-500 flex items-center mt-1">
                            <svg class="w-4 h-4 mr-1 text-blue-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"></path></svg>
                            Provincia di <span class="ml-1 font-semibold" x-text="selectedComune.provincia.nome"></span>
                        </p>
                    </div>
                    <div class="flex gap-3">
                        <div class="bg-blue-50 border border-blue-100 px-5 py-3 rounded-2xl text-center">
                            <p class="text-[10px] uppercase font-bold text-blue-400 tracking-wider">Zona Climatica</p>
                            <p class="text-2xl font-black text-blue-700" x-text="selectedComune.zona_climatica || 'E'"></p>
                        </div>
                        <div class="bg-orange-50 border border-orange-100 px-5 py-3 rounded-2xl text-center text-orange-700">
                            <p class="text-[10px] uppercase font-bold text-orange-400 tracking-wider">Abitanti</p>
                            <p class="text-2xl font-black" x-text="selectedComune.popolazione.toLocaleString()"></p>
                        </div>
                    </div>
                </div>

                <h3 class="text-xl font-bold mb-6 text-slate-800 flex items-center">
                    <span class="bg-blue-600 w-2 h-8 rounded-full mr-3"></span>
                    Opportunità Identificate
                </h3>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-20">
                    <template x-for="opt in opportunities" :key="opt.id">
                        <div class="group bg-white p-8 rounded-3xl border border-slate-200 shadow-sm hover:shadow-xl hover:-translate-y-1 transition-all duration-300 relative overflow-hidden">
                            <div class="absolute top-0 right-0 w-32 h-32 bg-slate-50 rounded-full -mr-16 -mt-16 transition-colors group-hover:bg-blue-50"></div>
                            
                            <div class="relative">
                                <div class="flex justify-between items-start mb-6">
                                    <span class="px-3 py-1 rounded-lg text-[10px] font-black uppercase tracking-tighter" 
                                          :class="opt.tipo === 'Sportello' ? 'bg-green-100 text-green-700' : 'bg-purple-100 text-purple-700'"
                                          x-text="opt.tipo"></span>
                                    <span class="text-2xl font-black text-blue-600" x-text="opt.incentivo"></span>
                                </div>

                                <h4 class="text-xl font-bold mb-3 text-slate-900 group-hover:text-blue-700 transition-colors" x-text="opt.titolo"></h4>
                                <p class="text-slate-500 text-sm leading-relaxed mb-8" x-text="opt.desc"></p>
                                
                                <div class="flex items-center gap-2 mb-6">
                                    <template x-for="tag in opt.tags">
                                        <span class="bg-slate-100 text-slate-600 text-[10px] px-2 py-1 rounded font-bold" x-text="tag"></span>
                                    </template>
                                </div>

                                <button @click="openKit(opt)" class="w-full bg-slate-900 text-white py-4 rounded-2xl font-bold text-lg hover:bg-blue-600 shadow-lg shadow-slate-200 hover:shadow-blue-200 transition-all flex justify-center items-center gap-2">
                                    Genera Kit Pratica
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
                                </button>
                            </div>
                        </div>
                    </template>
                </div>
            </div>

            <div x-show="!selectedComune && !loading" class="text-center py-20 opacity-30">
                <svg class="w-20 h-20 mx-auto text-slate-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path></svg>
                <p class="text-xl font-medium">Inizia la ricerca per visualizzare i fondi</p>
            </div>
        </main>

        <footer class="bg-white border-t border-slate-200 py-10">
            <div class="max-w-5xl mx-auto px-4 text-center text-slate-400 text-sm">
                PA-Assist © 2026 - Analisi normativa assistita da AI per il Settore AEC
            </div>
        </footer>
    </div>

    <script>
        function paAssist() {
            return {
                search: '',
                selectedComune: null,
                suggestions: [],
                comuniDB: [],
                loading: true,

                async initApp() {
                    try {
                        // Carica i 7.900+ comuni italiani aggiornati
                        const response = await fetch('https://raw.githubusercontent.com/matteocontrini/comuni-italiani/master/comuni.json');
                        this.comuniDB = await response.json();
                        this.loading = false;
                        console.log("Database comuni caricato: ", this.comuniDB.length);
                    } catch (e) {
                        console.error("Errore caricamento database comuni");
                    }
                },

                filterComuni() {
                    const q = this.search.toLowerCase();
                    if (q.length < 2) { 
                        this.suggestions = []; 
                        return; 
                    }
                    this.suggestions = this.comuniDB
                        .filter(c => c.nome.toLowerCase().includes(q))
                        .slice(0, 8);
                },

                selectComune(comune) {
                    this.selectedComune = comune;
                    this.search = comune.nome;
                    this.suggestions = [];
                },

                get opportunities() {
                    if (!this.selectedComune) return [];
                    
                    const pop = this.selectedComune.popolazione;
                    const zona = this.selectedComune.zona_climatica || 'E';

                    // DATABASE BANDI REALI (Logica di Matchmaking)
                    const bandi = [
                        {
                            id: 'ct3_pompe',
                            titolo: "Conto Termico 3.0 - Pompe di Calore PA",
                            desc: "Sostituzione di caldaie a combustibile fossile con sistemi a pompa di calore ad alta efficienza in edifici pubblici.",
                            incentivo: "65%",
                            tipo: "Sportello",
                            tags: ["Energia", "Climatizzazione"],
                            match: () => ['D', 'E', 'F'].includes(zona)
                        },
                        {
                            id: 'ct3_isoli',
                            titolo: "Conto Termico 3.0 - Isolamento Involucro",
                            desc: "Coibentazione di pareti e coperture di edifici pubblici (scuole, palestre, municipi).",
                            incentivo: "55%",
                            tipo: "Sportello",
                            tags: ["Involucro", "Risparmio"],
                            match: () => true // Sempre valido
                        },
                        {
                            id: 'piccoli_comuni',
                            titolo: "Bando Piccoli Comuni (Fondo Ordinario)",
                            desc: "Contributi per investimenti destinati a opere pubbliche di messa in sicurezza del patrimonio.",
                            incentivo: "100%",
                            tipo: "Bando",
                            tags: ["Sicurezza", "PNRR"],
                            match: () => pop < 5000
                        },
                        {
                            id: 'illuminazione_led',
                            titolo: "Programma LED Pubblica Illuminazione",
                            desc: "Efficientamento degli impianti di illuminazione pubblica tramite tecnologia LED e controllo remoto.",
                            incentivo: "50%",
                            tipo: "Bando Regionale",
                            tags: ["Smart City", "Illuminazione"],
                            match: () => true
                        },
                        {
                            id: 'ct3_solare',
                            titolo: "Conto Termico 3.0 - Solare Termico",
                            desc: "Installazione di collettori solari termici per la produzione di acqua calda sanitaria (ACS) in edifici PA.",
                            incentivo: "65%",
                            tipo: "Sportello",
                            tags: ["Rinnovabili", "ACS"],
                            match: () => ['B', 'C', 'D'].includes(zona)
                        }
                    ];

                    return bandi.filter(b => b.match());
                },

                openKit(opt) {
                    alert(`PREPARAZIONE KIT PRATICA:\n--------------------------\nComune: ${this.selectedComune.nome}\nIntervento: ${opt.titolo}\n\nQuesta funzione sbloccherà i modelli di Delibera e Determina precompilati in formato Word.\n\nPrezzo stimato: €149\n(Integrazione Stripe in arrivo...)`);
                }
            }
        }
    </script>
</body>
</html>